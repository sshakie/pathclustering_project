{% extends "base.html" %}
{% block title %} –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–∫–∞–∑—ã {% endblock %}

{% block content %}
<script src="https://api-maps.yandex.ru/2.1/?apikey=048dcdc9-7eb0-4ab1-aee9-f00f7bd7547f&lang=ru_RU"></script>
<link rel="stylesheet" href="/static/css/style.css">
<script src="/static/script/script_2.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>


<!--  –ù–ï –£–ë–ò–†–ê–¢–¨!!!! –ë–ï–ó –≠–¢–û–ì–û –ù–ï –ë–£–î–£–¢ –ü–û–†–¢–ò–†–û–í–ê–¢–¨–°–Ø –î–ê–ù–ù–´–ï –ò–ó –®–ê–ë–õ–û–ù–ê –í JS-->
<script>
  const courierData = {{ courier_data | tojson | safe }};
  const courierOrders = {{ courier_orders | tojson | safe }};
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('xls-input');
    if (input) {
      input.addEventListener('change', function() {
        if (this.files.length > 0) {
          // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à—É—é —Ñ–æ—Ä–º—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
          const form = this.closest('form');
          if (form) {
            form.submit();
          }
        }
      });
    }
  });
</script>




<!--–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞-->
<div class="modal fade" id="addOrderModal" tabindex="-1" aria-labelledby="addOrderModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addOrderModalLabel">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úñ</button>
      </div>
      <div class="modal-body">
        <form action="" method="post">
      {{ add_order_form.hidden_tag() }}
        <p>
          {{  add_order_form.name.label }}<br>
          {{ add_order_form.name(class="form-control") }}<br>
        </p>
        <p>
          {{  add_order_form.address.label }}<br>
          {{ add_order_form.address(class="form-control") }}<br>
        </p>
        <p>
          {{  add_order_form.phone.label }}<br>
          {{ add_order_form.phone(class="form-control") }}<br>
        </p>
        <p>
          {{  add_order_form.price.label }}<br>
          {{ add_order_form.price(class="form-control") }}<br>
        </p>
        <p>
          {{  add_order_form.analytics_id.label }}<br>
          {{ add_order_form.analytics_id(class="form-control") }}<br>
        </p>
          <p>
            {{ add_order_form.submit(type="submit", class="btn btn-primary") }}
            <button class="btn btn-success" onclick="document.getElementById('xls-input').click()" type="button">
              –ò–º–ø–æ—Ä—Ç
            </button>
          </p>
        </form>

        <!-- –°–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ -->
        <form action="" enctype="multipart/form-data" id="import-form" method="post" style="display: none;">
          {{ import_order_form.hidden_tag() }}
          {{ import_order_form.xls_file(id="xls-input") }}
          <button id="hidden-submit" type="submit"></button>
        </form>

      </div>
      <div class="modal-footer">
        <span>–ü—Ä–∏ –ø–∞–∫–µ—Ç–Ω–æ–º –∏–º–ø–æ—Ä—Ç–µ —Å–ª–µ–¥—É–π—Ç–µ –æ–±—Ä–∞–∑—Ü—É</span> <!-- –ù–∞–¥–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç—É -->
      </div>
    </div>
  </div>
</div>
<!--–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞-->
<div class="modal fade" id="ExportModal" tabindex="-1" aria-labelledby="ExportModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ExportModalLabel">–≠–∫—Å–ø–æ—Ä—Ç</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úñ</button>
      </div>
      <div class="modal-body">
      </div>
    </div>
  </div>
</div>


<div class="main-wrapper">
    <div class="orders-panel">
        <h2 class="orders-header">
            <span class="orders-text">Orders Count</span>
            <span class="orders-count-wrapper"><span id="orders-count">0</span></span>
        </h2>
        <div id="orders-list" class="orders-list"></div>
        <button class="add-order-btn" data-bs-toggle="modal" data-bs-target="#addOrderModal">‚ûï</button>
    </div>

    <div class="map-block">
        <div class="top-controls">
            <div class="address-search-wrapper" id="address-search-wrapper">
                <input type="text" id="address-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å..."/>
                <button id="address-search-btn">üîç</button>
            </div>
            <div class="tab-switch">
                <div class="tab active" id="tab-map">–∫–∞—Ä—Ç–∞</div>
                <div class="tab" id="tab-couriers">–∫—É—Ä—å–µ—Ä—ã</div>
            </div>
        </div>

    <div class="map-wrapper" id="map-wrapper">
      <div id="map" class="map"></div>
    </div>
    <div style="max-height: 5"><br></div>

        <div class="couriers hidden" id="couriers">
        <a>–ö—É—Ä—å–µ—Ä—ã—ã—ã—ã—ã—ã—ã—ã—ã—ã—ã</a>
    </div>

    <div align="center" style="min-height: 40">
    <button class="export-btn" data-bs-toggle="modal" data-bs-target="#ExportModal" id="exportbtn">–≠–∫—Å–ø–æ—Ä—Ç</button> <!--–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞-->
    <button class="clustering-btn" id="clusteringbtn">–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å</button>
      </div>
  </div>

  <div class="courier-panel" id="courier-panel">
    <div class="courier-filter-wrapper">
      <input type="text" id="courier-search" placeholder="–ù–∞–π—Ç–∏ –∫—É—Ä—å–µ—Ä–∞..." />
      <div id="courier-filter-buttons" class="courier-filters-scroll">
        <button class="courier-btn active" data-courier="all">–í—Å–µ</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}